<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ph√¢n Lo·∫°i B·ªánh Da Li·ªÖu</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Quicksand", sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #e8eef5 100%);
        overflow: hidden;
      }

      .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 65px;
        background: #fff;
        display: flex;
        align-items: center;
        padding: 0 25px;
        z-index: 1000;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        gap: 20px;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo-icon {
        width: 42px;
        height: 42px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .logo-text {
        font-weight: 700;
        font-size: 17px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .search-box {
        flex: 1;
        max-width: 400px;
        position: relative;
      }

      .search-box input {
        width: 100%;
        padding: 11px 18px 11px 44px;
        border: 1px solid #e0e4e8;
        border-radius: 25px;
        background: #f5f7f9;
        color: #3d4f5f;
        font-size: 14px;
        font-family: inherit;
        transition: all 0.2s;
      }

      .search-box input:focus {
        outline: none;
        border-color: #667eea;
        background: #fff;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .search-box::before {
        content: "üîç";
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 14px;
      }

      .btn-group {
        display: flex;
        gap: 8px;
      }

      .btn {
        padding: 9px 16px;
        border: 1px solid #e0e4e8;
        border-radius: 20px;
        background: #fff;
        color: #5a6a7a;
        font-size: 13px;
        font-weight: 600;
        font-family: inherit;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn:hover {
        background: #f0f4f8;
        border-color: #667eea;
        color: #667eea;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        border: none;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }

      .btn-primary:hover {
        opacity: 0.9;
        transform: translateY(-1px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
      }

      #canvas {
        position: fixed;
        top: 65px;
        left: 0;
        right: 0;
        bottom: 0;
        cursor: grab;
      }

      .panel {
        position: fixed;
        background: #fff;
        border-radius: 14px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        z-index: 100;
        padding: 16px 20px;
      }

      .legend-panel {
        left: 20px;
        bottom: 20px;
      }

      .legend-title {
        font-size: 11px;
        color: #8a9aa8;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 12px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 6px 0;
        font-size: 13px;
        color: #5a6a7a;
      }

      .legend-dot {
        width: 14px;
        height: 14px;
        border-radius: 4px;
      }

      .zoom-panel {
        right: 20px;
        bottom: 20px;
        padding: 8px;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .zoom-btn {
        width: 40px;
        height: 40px;
        border: none;
        background: #f5f7f9;
        color: #5a6a7a;
        font-size: 18px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .zoom-btn:hover {
        background: #e8ecf0;
        color: #3d4f5f;
      }

      .help-panel {
        right: 20px;
        top: 85px;
        font-size: 12px;
        color: #8a9aa8;
      }

      .help-panel div {
        padding: 4px 0;
      }
      .help-panel kbd {
        background: #f0f4f8;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: inherit;
      }

      #tooltip {
        position: fixed;
        background: #fff;
        padding: 14px 18px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
        border: 1px solid #e8ecf0;
        max-width: 320px;
        display: none;
        z-index: 2000;
        pointer-events: none;
      }

      .tt-badge {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 8px;
        color: #fff;
      }

      .tt-title {
        font-size: 14px;
        font-weight: 700;
        color: #3d4f5f;
      }
      .tt-sub {
        font-size: 13px;
        color: #6b9080;
        margin-top: 4px;
      }
      .tt-path {
        font-size: 11px;
        color: #8a9aa8;
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid #e8ecf0;
      }
      .tt-hint {
        font-size: 11px;
        color: #667eea;
        margin-top: 8px;
        font-weight: 600;
      }

      @media (max-width: 768px) {
        .logo-text {
          display: none;
        }
        .search-box {
          max-width: 180px;
        }
        .btn span:last-child {
          display: none;
        }
        .help-panel {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="logo">
        <div class="logo-icon">üè•</div>
        <span class="logo-text">Ph√¢n Lo·∫°i B·ªánh Da Li·ªÖu</span>
      </div>
      <div class="search-box">
        <input type="text" id="search" placeholder="T√¨m ki·∫øm b·ªánh..." />
      </div>
      <div class="btn-group">
        <button class="btn" onclick="collapseAll()">
          <span>üìÅ</span> <span>Thu g·ªçn</span>
        </button>
        <button class="btn" onclick="expandAll()">
          <span>üìÇ</span> <span>M·ªü h·∫øt</span>
        </button>
        <button class="btn btn-primary" onclick="resetView()">
          <span>‚Üª</span> <span>Reset</span>
        </button>
      </div>
    </header>

    <canvas id="canvas"></canvas>

    <div class="panel legend-panel">
      <div class="legend-title">Ch√∫ th√≠ch</div>
      <div class="legend-item">
        <div
          class="legend-dot"
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
        ></div>
        G·ªëc (1)
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #48bb78"></div>
        Nh√≥m ch√≠nh (19)
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #ed8936"></div>
        Nh√≥m ph·ª• (12)
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #4299e1"></div>
        B·ªánh (178)
      </div>
    </div>

    <div class="panel zoom-panel">
      <button class="zoom-btn" onclick="zoomIn()">+</button>
      <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
      <button class="zoom-btn" onclick="resetView()">‚ü≤</button>
    </div>

    <div class="panel help-panel">
      <div><kbd>Click</kbd> M·ªü/ƒë√≥ng</div>
      <div><kbd>K√©o</kbd> Di chuy·ªÉn</div>
      <div><kbd>Scroll</kbd> Zoom</div>
    </div>

    <div id="tooltip">
      <div class="tt-badge"></div>
      <div class="tt-title"></div>
      <div class="tt-sub"></div>
      <div class="tt-path"></div>
      <div class="tt-hint"></div>
    </div>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const tooltip = document.getElementById("tooltip");

      let W, H, cx, cy;
      let scale = 0.6,
        offX = 0,
        offY = 0;
      let dragging = false,
        dragX,
        dragY,
        moved = false;
      let hovered = null;
      let nodes = [],
        edges = [];

      // B·∫£ng m√†u hi·ªán ƒë·∫°i & chuy√™n nghi·ªáp
      const COLORS = {
        root: "#667eea", // T√≠m xanh gradient
        category: "#48bb78", // Xanh l√° t∆∞∆°i
        subcategory: "#ed8936", // Cam ·∫•m
        disease: "#4299e1", // Xanh d∆∞∆°ng s√°ng
      };

      const data = {
        "1. NHI·ªÑM TR√ôNG DA": {
          "1.1 Vi khu·∫©n": [
            ["Abscess", "√Åp xe"],
            ["Bacterial Skin Infection", "Nhi·ªÖm tr√πng da do vi khu·∫©n"],
            ["Cellulitis", "Vi√™m t·∫ø b√†o m√¥"],
            [
              "Cellulitis Impetigo and other Bacterial Infections",
              "Vi√™m t·∫ø b√†o m√¥, ch·ªëc l·ªü",
            ],
            ["Impetigo", "Ch·ªëc l·ªü"],
            ["Folliculitis", "Vi√™m nang l√¥ng"],
            ["Furuncle", "Nh·ªçt"],
            ["Staphylococcal Scalded Skin Syndrome", "H·ªôi ch·ª©ng da b·ªèng r·ªôp"],
            ["Pyoderma Gangrenosum", "Ho·∫°i t·ª≠ da m·ªß"],
            ["Hansen's Disease ‚Äì Leprosy", "B·ªánh Phong"],
            ["Leprosy (Hansen)", "Phong"],
          ],
          "1.2 Virus": [
            ["AIDS", "AIDS"],
            ["Chickenpox", "Th·ªßy ƒë·∫≠u"],
            ["Cowpox", "ƒê·∫≠u b√≤"],
            ["Monkeypox", "ƒê·∫≠u m√πa kh·ªâ"],
            ["Measles", "S·ªüi"],
            ["Hand Foot and mouth Disease", "Tay ch√¢n mi·ªáng"],
            ["Herpes Simplex", "Herpes ƒë∆°n gi·∫£n"],
            ["Herpes Zoster", "Zona"],
            ["Shingles", "Zona"],
            ["Herpes HPV and other STDs", "Herpes, HPV"],
            ["Molluscum Contagiosum", "Molluscum"],
            ["Contagiosum Molluscum", "Molluscum"],
            ["Warts", "M·ª•n c√≥c"],
            ["Genital Warts", "M·ª•n c√≥c sinh d·ª•c"],
            ["Verruca Plana", "M·ª•n c√≥c ph·∫≥ng"],
            [
              "Warts Molluscum and other viral Infections",
              "M·ª•n c√≥c, Molluscum",
            ],
            ["Viral exanthem", "Ph√°t ban virus"],
            ["Viral Infections", "Nhi·ªÖm virus"],
          ],
          "1.3 N·∫•m": [
            ["Tinea", "N·∫•m da"],
            ["Tinea corporis", "N·∫•m th√¢n"],
            ["Tinea Cruris", "N·∫•m h√°ng"],
            ["Tinea Faciei", "N·∫•m m·∫∑t"],
            ["Tinea Manuum", "N·∫•m tay"],
            ["Tinea Pedis", "N·∫•m ch√¢n"],
            ["Athlete Foot", "N·∫•m ch√¢n"],
            ["Tinea versicolor", "N·∫•m m√†u"],
            ["Ringworm", "N·∫•m v√≤ng"],
            ["Candidiasis", "N·∫•m Candida"],
            ["Candida Intertrigo", "N·∫•m k·∫Ω"],
            ["Candidiasis infant", "N·∫•m tr·∫ª em"],
            ["Candidas Ringworm tinea", "N·∫•m Candida"],
            ["Nail Fungus", "N·∫•m m√≥ng"],
            ["Nail Fungus and other nail", "N·∫•m m√≥ng"],
            [
              "Tinea Ringworm Candidiasis and Other fungal Infections",
              "Nhi·ªÖm n·∫•m",
            ],
          ],
          "1.4 K√Ω sinh tr√πng": [
            ["Scabies", "Gh·∫ª"],
            [
              "Scabies Lyme disease and other Infestations and bites",
              "Gh·∫ª, Lyme",
            ],
            ["Cutaneous Larva migrans", "S√°n da"],
            ["Leishmaniasis", "Leishmaniasis"],
            ["Tungiasis", "B·ªç ch√©t"],
            ["Infestations bites", "C√¥n tr√πng c·∫Øn"],
            ["Insect bite", "C√¥n tr√πng c·∫Øn"],
            ["Flea Allergy", "D·ªã ·ª©ng b·ªç ch√©t"],
          ],
        },
        "2. VI√äM DA & CH√ÄM": {
          "2.1 Ch√†m": [
            ["Eczema", "Ch√†m"],
            ["Atopic Dermatitis", "Vi√™m da c∆° ƒë·ªãa"],
            ["Chronic Eczema", "Ch√†m m√£n t√≠nh"],
            ["Subacute Eczema", "Ch√†m b√°n c·∫•p"],
            ["Hand Eczema", "Ch√†m tay"],
            ["Dyshidrotic Eczema", "Ch√†m m·ªì h√¥i"],
            ["Nummular eczema", "Ch√†m ƒë·ªìng xu"],
            ["Xerotic Eczema", "Ch√†m kh√¥"],
            ["Pompholyx", "Ch√†m b√≥ng n∆∞·ªõc"],
            ["Miliaria", "R√¥m s·∫£y"],
          ],
          "2.2 Vi√™m da ti·∫øp x√∫c": [
            ["Allergic Contact Dermatitis", "Vi√™m da d·ªã ·ª©ng"],
            ["Poison Ivy and other contact dermatitis", "Vi√™m da ti·∫øp x√∫c"],
          ],
          "2.3 Vi√™m da kh√°c": [
            ["Dermatitis", "Vi√™m da"],
            ["Seborrheic Dermatitis", "Vi√™m da ti·∫øt b√£"],
            ["Perioral Dermatitis", "Vi√™m da quanh mi·ªáng"],
            ["Dermatitis Stasis", "Vi√™m da ·ª© tr·ªá"],
          ],
        },
        "3. V·∫¢Y N·∫æN": {
          "3.1 Psoriasis": [
            ["Psoriasis", "V·∫£y n·∫øn"],
            ["Psoriasis Chronic Plaque", "V·∫£y n·∫øn m·∫£ng"],
            ["Guttate Psoriasis", "V·∫£y n·∫øn gi·ªçt"],
            ["Psoriasis Pustular", "V·∫£y n·∫øn m·ªß"],
            ["Psoriasis Erythrodermic", "V·∫£y n·∫øn ƒë·ªè da"],
            ["Nail Psoriasis", "V·∫£y n·∫øn m√≥ng"],
            ["Psoriasis Pitting", "V·∫£y n·∫øn l√µm m√≥ng"],
            ["Psoriasis Digits", "V·∫£y n·∫øn ng√≥n"],
            ["Psoriasis Anal", "V·∫£y n·∫øn h·∫≠u m√¥n"],
            ["Psoriasis Umbilicus", "V·∫£y n·∫øn r·ªën"],
            ["Psoriasis Cellulitis", "V·∫£y n·∫øn vi√™m"],
            ["Psoriatic Arthritis", "Vi√™m kh·ªõp v·∫£y n·∫øn"],
            ["Palmoplantar Pustulosis", "M·ª•n m·ªß l√≤ng b√†n"],
            ["Psoriasis Lichen Planus and Related Diseases", "V·∫£y n·∫øn, Lichen"],
          ],
          "3.2 Lichen": [
            ["Lichen", "Lichen"],
            ["Lichen Simplex Chronicus", "Lichen m√£n t√≠nh"],
            ["Lichen Sclerosus", "Lichen x∆° c·ª©ng"],
          ],
        },
        "4. M·ª§N & ROSACEA": {
          _: [
            ["Acne", "M·ª•n tr·ª©ng c√°"],
            ["Acne and Rosacea", "M·ª•n v√† Rosacea"],
            ["Rosacea", "Rosacea"],
            ["Blackheads", "M·ª•n ƒë·∫ßu ƒëen"],
            ["Whiteheads", "M·ª•n ƒë·∫ßu tr·∫Øng"],
          ],
        },
        "5. B·ªÜNH B√ìNG N∆Ø·ªöC": {
          _: [
            ["Bullous", "B√≥ng n∆∞·ªõc"],
            ["Bullous Pemphigoid", "Pemphigoid"],
            ["Epidermolysis Bullosa", "Bong bi·ªÉu b√¨"],
            ["Epidermolysis Bullosa Pruriginosa", "Bong bi·ªÉu b√¨ ng·ª©a"],
          ],
        },
        "6. R·ªêI LO·∫†N S·∫ÆC T·ªê": {
          "6.1 TƒÉng s·∫Øc t·ªë": [
            ["Hyperpigmentation", "TƒÉng s·∫Øc t·ªë"],
            ["Lentigo", "ƒê·ªìi m·ªìi"],
            ["Freckles", "T√†n nhang"],
            ["Blackspot", "ƒê·ªëm ƒëen"],
            ["Darkcircle", "Th√¢m m·∫Øt"],
          ],
          "6.2 Gi·∫£m s·∫Øc t·ªë": [
            ["Hypopigmentation", "Gi·∫£m s·∫Øc t·ªë"],
            ["Vitiligo", "B·∫°ch bi·∫øn"],
            ["Nevus Depigmentosus", "Nevi m·∫•t s·∫Øc t·ªë"],
          ],
          "6.3 Kh√°c": [
            ["Light disease and Disorders of pigmentation", "R·ªëi lo·∫°n s·∫Øc t·ªë"],
          ],
        },
        "7. U & T√ÇN SINH": {
          "7.1 U l√†nh t√≠nh": [
            ["Benign Tumors", "U l√†nh"],
            ["Benign Keratosis like lesion", "S·ª´ng h√≥a l√†nh"],
            ["Dermatofibroma", "U x∆° da"],
            ["Angiofibroma", "U x∆° m·∫°ch"],
            ["Skin Tag", "M·ª•n th·ªãt"],
            ["Epidermal Cyst", "Nang bi·ªÉu b√¨"],
            ["Inflamed Cyst", "Nang vi√™m"],
            ["Steatocystoma", "Nang b√£"],
            ["Keratocanthoma", "U s·ª´ng"],
            ["Juvenile Xanthogranuloma", "U h·∫°t v√†ng"],
            ["Xanthelasma", "V√†ng m√≠ m·∫Øt"],
            ["Neurofibromatosis", "U x∆° th·∫ßn kinh"],
            ["Confluent Reticulated Papillomatosis", "U nh√∫ l∆∞·ªõi"],
          ],
          "7.2 U √°c t√≠nh": [
            ["Malignant", "√Åc t√≠nh"],
            ["Skin cancer", "Ung th∆∞ da"],
            ["Melanoma", "Melanoma"],
            ["Melona", "Melanoma"],
            ["Melanoma skin cancer nevi and moles", "Melanoma, nevi"],
            ["Basal Cell Carcinoma", "Ung th∆∞ t·∫ø b√†o ƒë√°y"],
            ["Squamous Cell Carcinoma", "Ung th∆∞ t·∫ø b√†o v·∫£y"],
            ["Non-Melanoma Skin Cancer", "Ung th∆∞ kh√¥ng melanoma"],
            ["Bowen's Disease", "B·ªánh Bowen"],
          ],
          "7.3 Ti·ªÅn ung th∆∞": [
            ["Actinic Keratosis", "S·ª´ng h√≥a √°nh s√°ng"],
            [
              "Actinic Keratosis Basal Cell Carcinoma and other malignant lesion",
              "S·ª´ng h√≥a, ung th∆∞",
            ],
          ],
        },
        "8. NEVI & N·ªêT RU·ªíI": {
          _: [
            ["Moles (Nevus)", "N·ªët ru·ªìi"],
            ["Melanocytic nevus", "Nevi h·∫Øc t·ªë"],
            ["Congenital nevus", "Nevi b·∫©m sinh"],
            ["Blue nevus", "Nevi xanh"],
            ["Becker's nevus", "Nevi Becker"],
            ["Epidermal Nevus", "Nevi bi·ªÉu b√¨"],
            ["Organoid Nevus", "Nevi c∆° quan"],
            ["Ota nevus", "Nevi Ota"],
          ],
        },
        "9. U M·∫†CH M√ÅU": {
          _: [
            ["Vascular", "M·∫°ch m√°u"],
            ["Vascular lesion", "T·ªïn th∆∞∆°ng m·∫°ch"],
            ["Vascular Tumors", "U m·∫°ch"],
            ["Hemangioma", "U m√°u"],
            ["Lymphangioma", "U b·∫°ch huy·∫øt"],
            ["Angiokeratoma", "U s·ª´ng m·∫°ch"],
          ],
        },
        "10. VI√äM M·∫†CH": {
          _: [
            ["Vasculitis", "Vi√™m m·∫°ch"],
            ["Urticarial Vasculitis", "Vi√™m m·∫°ch m√†y ƒëay"],
          ],
        },
        "11. M√ÄY ƒêAY": {
          _: [
            ["Urticaria Hives", "M√†y ƒëay"],
            ["Urticaria Pigmentosa", "M√†y ƒëay s·∫Øc t·ªë"],
          ],
        },
        "12. BAN ƒê·ªé": {
          _: [
            ["Erythema", "Ban ƒë·ªè"],
            ["Erythema multiforme", "Ban ƒë·ªè ƒëa h√¨nh"],
            ["Erythema nodosum", "Ban ƒë·ªè n·ªët"],
            ["Erythema Annulare Centrifugum", "Ban ƒë·ªè v√≤ng"],
            ["Erythema Chronicum migrans", "Ban ƒë·ªè di chuy·ªÉn"],
            ["Erythema marginatum", "Ban ƒë·ªè vi·ªÅn"],
            ["Erythema Infections", "Nhi·ªÖm tr√πng ban ƒë·ªè"],
          ],
        },
        "13. PH√ÅT BAN DO THU·ªêC": {
          _: [
            ["Drug Eruption", "Ph√°t ban thu·ªëc"],
            ["Exanthems and drug Eruptions", "Ph√°t ban"],
            ["Acute Generalized Exanthematous Pustulosis", "M·ª•n m·ªß c·∫•p"],
            ["SJS-TEN", "Stevens-Johnson"],
            ["Phototoxic Reaction", "Ph·∫£n ·ª©ng quang ƒë·ªôc"],
          ],
        },
        "14. T·ª∞ MI·ªÑN": {
          _: [
            ["Lupus", "Lupus"],
            ["Lupus Erythematosus Chronicus Discoides", "Lupus d·∫°ng ƒëƒ©a"],
            ["Lupus Planus", "Lupus ph·∫≥ng"],
            ["Lupus and other connective tissue", "Lupus, m√¥ li√™n k·∫øt"],
            ["Lumpus connective tissue disease", "B·ªánh m√¥ li√™n k·∫øt"],
            ["Morphea", "X∆° c·ª©ng khu tr√∫"],
            ["Selenosis Tuberous", "X∆° c·ª©ng c·ªß"],
          ],
        },
        "15. R·ª§NG T√ìC": {
          _: [
            ["Alopecia", "R·ª•ng t√≥c"],
            ["Alopecia Areata", "R·ª•ng t√≥c m·∫£ng"],
            ["Hair loss photos alopecia", "H√≥i ƒë·∫ßu"],
          ],
        },
        "16. S·ª™NG H√ìA": {
          _: [
            ["Hyperkeratosis", "TƒÉng s·ª´ng"],
            ["Keratosis Pilaris", "S·ª´ng nang l√¥ng"],
            ["Seborrheic Keratoses", "S·ª´ng ti·∫øt b√£"],
            [
              "Seborrheic Keratoses and other Benign Tumors",
              "S·ª´ng ti·∫øt b√£, u l√†nh",
            ],
            ["Porokeratosis", "S·ª´ng l·ªó ch√¢n l√¥ng"],
            ["Harlequin ichthyosis", "B·ªánh c√° h·ªÅ"],
            ["Daner's Disease", "B·ªánh Darier"],
          ],
        },
        "17. U H·∫†T": {
          _: [
            ["Granuloma", "U h·∫°t"],
            ["Annulare Granuloma", "U h·∫°t v√≤ng"],
          ],
        },
        "18. PRURIGO": {
          _: [
            ["Pringo Nodularis", "Prurigo n·ªët"],
            ["Prurigo Pigmentosa", "Prurigo s·∫Øc t·ªë"],
          ],
        },
        "19. B·ªÜNH KH√ÅC": {
          _: [
            ["Pityriasis Rosea", "Ph·∫•n h·ªìng"],
            ["Pityriasis Rubra pilaris", "Pityriasis rubra"],
            ["Desquamation", "Bong v·∫£y"],
            ["Chapped Fissured Feet", "N·ª©t ch√¢n"],
            ["Red Scaly Rash", "Ph√°t ban v·∫£y"],
            ["Sunlight damage", "T·ªïn th∆∞∆°ng n·∫Øng"],
            ["Wrinkle", "N·∫øp nhƒÉn"],
            ["Disease", "B·ªánh"],
            ["System Disease", "B·ªánh h·ªá th·ªëng"],
            ["Infected", "Nhi·ªÖm tr√πng"],
            ["Non-Infected", "Kh√¥ng nhi·ªÖm"],
            ["Unknown normal", "B√¨nh th∆∞·ªùng"],
            ["Hailey Hailey Disease", "Hailey Hailey"],
          ],
        },
      };

      function resize() {
        W = canvas.width = window.innerWidth;
        H = canvas.height = window.innerHeight - 65;
        cx = W / 2;
        cy = H / 2;
      }

      function buildGraph() {
        nodes = [];
        edges = [];

        // Root
        const root = {
          id: "root",
          label: "DA LI·ªÑU",
          labelVn: "Dermatology",
          type: "root",
          x: cx,
          y: cy,
          w: 120,
          h: 60,
          expanded: true,
          visible: true,
          children: [],
          parent: null,
          path: "DA LI·ªÑU",
        };
        nodes.push(root);

        const cats = Object.keys(data);
        const catR = 400; // B√°n k√≠nh v√≤ng category

        cats.forEach((catName, i) => {
          const ang = (i / cats.length) * Math.PI * 2 - Math.PI / 2;
          const cat = {
            id: `c${i}`,
            label: catName.replace(/^\d+\.\s*/, ""),
            labelFull: catName,
            type: "category",
            x: cx + Math.cos(ang) * catR,
            y: cy + Math.sin(ang) * catR,
            w: 130,
            h: 50,
            expanded: false,
            visible: true,
            children: [],
            parent: root,
            path: `DA LI·ªÑU ‚Üí ${catName}`,
            ang,
          };
          nodes.push(cat);
          root.children.push(cat);
          edges.push({ from: root, to: cat });

          const subs = Object.keys(data[catName]);
          const subR = 250; // B√°n k√≠nh t·ª´ category ƒë·∫øn sub/disease
          const diseaseR = 200; // B√°n k√≠nh t·ª´ sub ƒë·∫øn disease

          if (subs.length === 1 && subs[0] === "_") {
            // Kh√¥ng c√≥ subcategory - disease n·ªëi th·∫≥ng
            const diseases = data[catName]["_"];
            const spread = Math.min(Math.PI * 0.8, diseases.length * 0.12);
            diseases.forEach((d, j) => {
              const dAng =
                ang -
                spread / 2 +
                (diseases.length > 1
                  ? (j / (diseases.length - 1)) * spread
                  : 0);
              const disease = {
                id: `d${i}_${j}`,
                label: d[0],
                labelVn: d[1],
                type: "disease",
                x: cat.x + Math.cos(dAng) * subR,
                y: cat.y + Math.sin(dAng) * subR,
                w: 140,
                h: 44,
                expanded: false,
                visible: false,
                children: [],
                parent: cat,
                path: `DA LI·ªÑU ‚Üí ${catName} ‚Üí ${d[0]}`,
              };
              nodes.push(disease);
              cat.children.push(disease);
              edges.push({ from: cat, to: disease });
            });
          } else {
            // C√≥ subcategory
            const subSpread = Math.min(Math.PI * 0.6, subs.length * 0.2);
            subs.forEach((subName, j) => {
              const subAng =
                ang -
                subSpread / 2 +
                (subs.length > 1 ? (j / (subs.length - 1)) * subSpread : 0);
              const sub = {
                id: `s${i}_${j}`,
                label: subName.replace(/^\d+\.\d+\s*/, ""),
                labelFull: subName,
                type: "subcategory",
                x: cat.x + Math.cos(subAng) * (subR * 0.7),
                y: cat.y + Math.sin(subAng) * (subR * 0.7),
                w: 110,
                h: 40,
                expanded: false,
                visible: false,
                children: [],
                parent: cat,
                path: `DA LI·ªÑU ‚Üí ${catName} ‚Üí ${subName}`,
                ang: subAng,
              };
              nodes.push(sub);
              cat.children.push(sub);
              edges.push({ from: cat, to: sub });

              const diseases = data[catName][subName];
              const dSpread = Math.min(Math.PI * 0.7, diseases.length * 0.1);
              diseases.forEach((d, k) => {
                const dAng =
                  subAng -
                  dSpread / 2 +
                  (diseases.length > 1
                    ? (k / (diseases.length - 1)) * dSpread
                    : 0);
                const disease = {
                  id: `d${i}_${j}_${k}`,
                  label: d[0],
                  labelVn: d[1],
                  type: "disease",
                  x: sub.x + Math.cos(dAng) * diseaseR,
                  y: sub.y + Math.sin(dAng) * diseaseR,
                  w: 140,
                  h: 44,
                  expanded: false,
                  visible: false,
                  children: [],
                  parent: sub,
                  path: `DA LI·ªÑU ‚Üí ${catName} ‚Üí ${subName} ‚Üí ${d[0]}`,
                };
                nodes.push(disease);
                sub.children.push(disease);
                edges.push({ from: sub, to: disease });
              });
            });
          }
        });
      }

      function roundRect(x, y, w, h, r) {
        ctx.beginPath();
        ctx.moveTo(x + r, y);
        ctx.lineTo(x + w - r, y);
        ctx.quadraticCurveTo(x + w, y, x + w, y + r);
        ctx.lineTo(x + w, y + h - r);
        ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
        ctx.lineTo(x + r, y + h);
        ctx.quadraticCurveTo(x, y + h, x, y + h - r);
        ctx.lineTo(x, y + r);
        ctx.quadraticCurveTo(x, y, x + r, y);
        ctx.closePath();
      }

      function truncate(text, maxW) {
        ctx.font = "600 11px Quicksand";
        if (ctx.measureText(text).width <= maxW) return text;
        while (ctx.measureText(text + "..").width > maxW && text.length > 2)
          text = text.slice(0, -1);
        return text + "..";
      }

      function draw() {
        // Gradient background
        const gradient = ctx.createLinearGradient(0, 0, W, H);
        gradient.addColorStop(0, "#f5f7fa");
        gradient.addColorStop(1, "#e8eef5");
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, W, H);

        ctx.save();
        ctx.translate(offX, offY);
        ctx.scale(scale, scale);

        // Edges
        edges.forEach((e) => {
          if (!e.from.visible || !e.to.visible) return;
          ctx.beginPath();
          ctx.moveTo(e.from.x, e.from.y);
          ctx.lineTo(e.to.x, e.to.y);
          ctx.strokeStyle =
            e.from.highlight || e.to.highlight ? "#f6ad55" : "#cbd5e0";
          ctx.lineWidth = e.from.highlight || e.to.highlight ? 3 : 2;
          ctx.stroke();
        });

        // Nodes
        nodes
          .filter((n) => n.visible)
          .forEach((node) => {
            const color = COLORS[node.type];
            let { x, y, w, h } = node;

            // Hover effect
            if (node === hovered) {
              ctx.shadowColor = color;
              ctx.shadowBlur = 15;
              w *= 1.03;
              h *= 1.03;
            }
            if (node.highlight) {
              ctx.shadowColor = "#f6ad55";
              ctx.shadowBlur = 25;
            }

            // Background with gradient for root node
            roundRect(x - w / 2, y - h / 2, w, h, 12);
            if (node.type === "root") {
              const grad = ctx.createLinearGradient(
                x - w / 2,
                y - h / 2,
                x + w / 2,
                y + h / 2
              );
              grad.addColorStop(0, "#667eea");
              grad.addColorStop(1, "#764ba2");
              ctx.fillStyle = grad;
            } else {
              ctx.fillStyle = color;
            }
            ctx.fill();
            ctx.shadowBlur = 0;

            // Border n·∫øu c√≥ children
            if (node.children.length > 0) {
              ctx.strokeStyle = node.expanded
                ? "#fff"
                : "rgba(255,255,255,0.5)";
              ctx.lineWidth = 2;
              ctx.stroke();
            }

            // Text
            ctx.fillStyle = "#fff";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";

            if (node.type === "root") {
              ctx.font = "700 16px Quicksand";
              ctx.fillText("üè• " + node.label, x, y);
            } else if (node.type === "category") {
              ctx.font = "700 12px Quicksand";
              ctx.fillText(truncate(node.label, w - 16), x, y - 6);
              if (node.children.length && !node.expanded) {
                ctx.font = "500 10px Quicksand";
                ctx.fillStyle = "rgba(255,255,255,0.85)";
                ctx.fillText(`+${node.children.length}`, x, y + 10);
              }
            } else if (node.type === "subcategory") {
              ctx.font = "600 11px Quicksand";
              ctx.fillText(truncate(node.label, w - 12), x, y - 5);
              if (node.children.length && !node.expanded) {
                ctx.font = "500 9px Quicksand";
                ctx.fillStyle = "rgba(255,255,255,0.85)";
                ctx.fillText(`+${node.children.length}`, x, y + 9);
              }
            } else {
              // Disease - 2 d√≤ng
              ctx.font = "600 10px Quicksand";
              ctx.fillText(truncate(node.label, w - 14), x, y - 6);
              ctx.font = "500 9px Quicksand";
              ctx.fillStyle = "rgba(255,255,255,0.85)";
              ctx.fillText(truncate(node.labelVn, w - 14), x, y + 8);
            }
          });

        ctx.restore();
        requestAnimationFrame(draw);
      }

      function toggle(node) {
        if (!node.children.length) return;
        node.expanded = !node.expanded;
        node.children.forEach((c) => {
          c.visible = node.expanded;
          if (!node.expanded) {
            c.expanded = false;
            hide(c);
          }
        });
      }

      function hide(node) {
        node.children.forEach((c) => {
          c.visible = false;
          c.expanded = false;
          hide(c);
        });
      }

      function toWorld(sx, sy) {
        return { x: (sx - offX) / scale, y: (sy - offY) / scale };
      }

      function nodeAt(sx, sy) {
        const { x, y } = toWorld(sx, sy - 65);
        for (let i = nodes.length - 1; i >= 0; i--) {
          const n = nodes[i];
          if (!n.visible) continue;
          if (
            x >= n.x - n.w / 2 &&
            x <= n.x + n.w / 2 &&
            y >= n.y - n.h / 2 &&
            y <= n.y + n.h / 2
          )
            return n;
        }
        return null;
      }

      function showTip(node, mx, my) {
        const types = {
          root: ["G·ªëc", "#667eea"],
          category: ["Nh√≥m ch√≠nh", "#48bb78"],
          subcategory: ["Nh√≥m ph·ª•", "#ed8936"],
          disease: ["B·ªánh", "#4299e1"],
        };
        const [t, c] = types[node.type];
        tooltip.querySelector(".tt-badge").textContent = t;
        tooltip.querySelector(".tt-badge").style.background = c;
        tooltip.querySelector(".tt-badge").style.color = "#fff";
        tooltip.querySelector(".tt-title").textContent =
          node.labelFull || node.label;
        tooltip.querySelector(".tt-sub").textContent = node.labelVn || "";
        tooltip.querySelector(".tt-sub").style.display = node.labelVn
          ? "block"
          : "none";
        tooltip.querySelector(".tt-path").textContent = "üìç " + node.path;
        tooltip.querySelector(".tt-hint").textContent = node.children.length
          ? node.expanded
            ? "Click ƒë·ªÉ thu g·ªçn"
            : `Click ƒë·ªÉ m·ªü ${node.children.length} m·ª•c`
          : "";
        tooltip.querySelector(".tt-hint").style.display = node.children.length
          ? "block"
          : "none";

        let l = mx + 12,
          t2 = my + 12;
        if (l + 300 > W) l = mx - 310;
        if (t2 + 160 > H + 65) t2 = my - 170;
        tooltip.style.left = l + "px";
        tooltip.style.top = t2 + "px";
        tooltip.style.display = "block";
      }

      function hideTip() {
        tooltip.style.display = "none";
      }

      // Events
      canvas.addEventListener("mousedown", (e) => {
        dragging = true;
        dragX = e.clientX;
        dragY = e.clientY;
        moved = false;
      });
      canvas.addEventListener("mousemove", (e) => {
        if (dragging) {
          const dx = e.clientX - dragX,
            dy = e.clientY - dragY;
          if (Math.abs(dx) > 2 || Math.abs(dy) > 2) moved = true;
          offX += dx;
          offY += dy;
          dragX = e.clientX;
          dragY = e.clientY;
          hideTip();
        } else {
          const n = nodeAt(e.clientX, e.clientY);
          hovered = n;
          canvas.style.cursor = n ? "pointer" : "grab";
          n ? showTip(n, e.clientX, e.clientY) : hideTip();
        }
      });
      canvas.addEventListener("mouseup", () => {
        dragging = false;
        if (!moved && hovered) toggle(hovered);
      });
      canvas.addEventListener("mouseleave", () => {
        dragging = false;
        hovered = null;
        hideTip();
      });
      canvas.addEventListener(
        "wheel",
        (e) => {
          e.preventDefault();
          const d = e.deltaY > 0 ? 0.9 : 1.1;
          const ns = Math.max(0.15, Math.min(2.5, scale * d));
          const mx = e.clientX,
            my = e.clientY - 65;
          offX = mx - (mx - offX) * (ns / scale);
          offY = my - (my - offY) * (ns / scale);
          scale = ns;
        },
        { passive: false }
      );

      // Touch
      let lastD = 0;
      canvas.addEventListener("touchstart", (e) => {
        if (e.touches.length === 1) {
          dragging = true;
          dragX = e.touches[0].clientX;
          dragY = e.touches[0].clientY;
          moved = false;
        } else if (e.touches.length === 2)
          lastD = Math.hypot(
            e.touches[0].clientX - e.touches[1].clientX,
            e.touches[0].clientY - e.touches[1].clientY
          );
      });
      canvas.addEventListener(
        "touchmove",
        (e) => {
          e.preventDefault();
          if (e.touches.length === 1 && dragging) {
            const dx = e.touches[0].clientX - dragX,
              dy = e.touches[0].clientY - dragY;
            if (Math.abs(dx) > 3 || Math.abs(dy) > 3) moved = true;
            offX += dx;
            offY += dy;
            dragX = e.touches[0].clientX;
            dragY = e.touches[0].clientY;
          } else if (e.touches.length === 2) {
            const d = Math.hypot(
              e.touches[0].clientX - e.touches[1].clientX,
              e.touches[0].clientY - e.touches[1].clientY
            );
            if (lastD)
              scale = Math.max(0.15, Math.min(2.5, (scale * d) / lastD));
            lastD = d;
          }
        },
        { passive: false }
      );
      canvas.addEventListener("touchend", (e) => {
        dragging = false;
        lastD = 0;
        if (!moved && e.changedTouches.length === 1) {
          const n = nodeAt(
            e.changedTouches[0].clientX,
            e.changedTouches[0].clientY
          );
          if (n) toggle(n);
        }
      });

      // Search
      document.getElementById("search").addEventListener("input", (e) => {
        const q = e.target.value.toLowerCase().trim();
        nodes.forEach((n) => (n.highlight = false));
        if (!q) return;
        nodes.forEach((n) => {
          if (
            n.label.toLowerCase().includes(q) ||
            (n.labelVn && n.labelVn.toLowerCase().includes(q)) ||
            (n.labelFull && n.labelFull.toLowerCase().includes(q))
          ) {
            n.highlight = true;
            n.visible = true;
            let p = n.parent;
            while (p) {
              p.expanded = true;
              p.highlight = true;
              p.children.forEach((c) => (c.visible = true));
              p = p.parent;
            }
          }
        });
      });

      // Controls
      function zoomIn() {
        scale = Math.min(2.5, scale * 1.3);
      }
      function zoomOut() {
        scale = Math.max(0.15, scale * 0.7);
      }
      function resetView() {
        scale = 0.6;
        offX = 0;
        offY = 0;
        nodes.forEach((n) => (n.highlight = false));
        document.getElementById("search").value = "";
      }
      function expandAll() {
        nodes.forEach((n) => {
          n.expanded = true;
          n.visible = true;
        });
        scale = 0.15;
        offX = W * 0.42;
        offY = H * 0.42;
      }
      function collapseAll() {
        nodes.forEach((n) => {
          n.visible = n.type === "root" || n.type === "category";
          n.expanded = n.type === "root";
        });
        resetView();
      }

      // Init
      window.addEventListener("resize", resize);
      resize();
      buildGraph();
      draw();
    </script>
  </body>
</html>
